# 撮影ガイド機能 - 動作テスト手順

このドキュメントは、Phase 2 Step 2-3で実装した「撮影ガイド機能」の動作テスト手順を、初心者にもわかりやすく説明します。

---

## 📋 目次
1. [事前準備](#事前準備)
2. [開発サーバーの起動](#開発サーバーの起動)
3. [基本動作テスト](#基本動作テスト)
4. [詳細機能テスト](#詳細機能テスト)
5. [トラブルシューティング](#トラブルシューティング)

---

## 事前準備

### 必要なもの
- ✅ パソコン（Windows/Mac/Linux）
- ✅ Webブラウザ（Chrome推奨、Android実機テストの場合はスマートフォン）
- ✅ カメラが使えるデバイス（PC内蔵カメラ、またはAndroidスマートフォン）
- ✅ Python（HTTPサーバー起動用）または Node.js

### ⚠️ 重要な注意事項
**カメラ機能はHTTPSまたはlocalhostでのみ動作します**
- `file://` （ファイルを直接ブラウザで開く方法）では動作しません
- 必ず開発サーバーを起動してアクセスしてください

---

## 開発サーバーの起動

### 方法1: Python 3を使う場合（推奨）

#### ステップ1: コマンドプロンプト/ターミナルを開く
- **Windows**: `Windows + R` → `cmd` と入力 → Enter
- **Mac**: `Command + Space` → `ターミナル` と入力 → Enter

#### ステップ2: プロジェクトフォルダに移動
```bash
cd "D:\UserData\Projects\Blood Pressure Tracker"
```
💡 **ヒント**: フォルダをコマンドプロンプトにドラッグ&ドロップすると、パスが自動入力されます

#### ステップ3: HTTPサーバーを起動
```bash
python -m http.server 8000
```

#### ステップ4: 起動確認
以下のようなメッセージが表示されればOKです：
```
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
```

#### ステップ5: ブラウザでアクセス
Chromeを開いて、以下のURLにアクセス：
```
http://localhost:8000
```

---

### 方法2: Node.jsを使う場合

#### ステップ1: コマンドプロンプト/ターミナルを開く
（方法1と同じ）

#### ステップ2: プロジェクトフォルダに移動
```bash
cd "D:\UserData\Projects\Blood Pressure Tracker"
```

#### ステップ3: http-serverをインストール（初回のみ）
```bash
npm install -g http-server
```

#### ステップ4: HTTPサーバーを起動
```bash
http-server
```

#### ステップ5: ブラウザでアクセス
表示されたURLにアクセス（通常は `http://localhost:8080`）

---

### 🔴 サーバーの停止方法
コマンドプロンプト/ターミナルで `Ctrl + C` を押すと停止します

---

## 基本動作テスト

### テスト1: カメラモーダルの表示

#### 手順
1. ブラウザで `http://localhost:8000` を開く
2. 画面上部の「📷 カメラで撮影」ボタンをクリック

#### ✅ 確認ポイント
- [ ] モーダル（ポップアップ画面）が表示される
- [ ] 「カメラを起動中...」というメッセージが表示される
- [ ] カメラの許可を求めるダイアログが表示される

#### カメラ許可ダイアログが表示されたら
- 「許可」または「Allow」をクリック
- 💡 間違って「ブロック」を押した場合は、[トラブルシューティング](#カメラが起動しない)を参照

---

### テスト2: 撮影ガイドの表示確認

カメラが起動したら、以下を確認します。

#### ✅ 確認ポイント1: ガイド枠の表示
- [ ] 画面中央に **青い枠**（ガイド枠）が表示される
- [ ] 枠の外側が **薄暗く（半透明のマスク）** なっている
- [ ] 枠の中だけが明るく見える

#### ✅ 確認ポイント2: テキストの表示
- [ ] 画面上部に **「血圧計の表示部分を枠内に合わせてください」** と表示される
- [ ] その下に小さく **「明るい場所で、反射に注意してください」** と表示される
- [ ] テキストが **黒い半透明の背景** の上に白文字で表示される
- [ ] テキストが読みやすい

#### ✅ 確認ポイント3: ガイド枠の位置
- [ ] ガイド枠が画面の **中央** に配置されている
- [ ] ガイド枠の下に **シャッターボタン** が見える（重なっていない）
- [ ] ガイド枠の下に **閉じるボタン** が見える（重なっていない）

#### 📸 参考: 正常な表示例
```
┌─────────────────────────────────┐
│                                 │
│  血圧計の表示部分を枠内に...      │ ← 案内テキスト
│  明るい場所で、反射に注意...      │ ← ヒント
│                                 │
│    ┏━━━━━━━━━━━━━━┓          │
│    ┃                ┃          │ ← ガイド枠（青枠）
│    ┃  ここに合わせる  ┃          │
│    ┃                ┃          │
│    ┗━━━━━━━━━━━━━━┛          │
│                                 │
│  [📸 シャッター]  [✕ 閉じる]   │ ← 操作ボタン
└─────────────────────────────────┘
```

---

### テスト3: 操作ボタンの動作確認

#### 手順1: シャッターボタンのテスト
1. 「📸 シャッター」ボタンをクリック
2. 少し待つ（処理中のメッセージが表示される）

#### ✅ 確認ポイント
- [ ] ボタンが一時的に無効化される（グレーアウト）
- [ ] 「📸 撮影中...」と表示が変わる
- [ ] 「画像を処理中...」というメッセージが表示される
- [ ] 撮影が完了すると、撮影した画像がプレビュー表示される
- [ ] ガイド枠が **消える**（撮影後は表示されない）

#### 手順2: 再撮影ボタンのテスト
1. 撮影後、「🔄 再撮影」ボタンをクリック

#### ✅ 確認ポイント
- [ ] カメラプレビューに戻る
- [ ] ガイド枠が **再表示される**
- [ ] テキストも再表示される

#### 手順3: 閉じるボタンのテスト
1. 「✕ 閉じる」ボタンをクリック

#### ✅ 確認ポイント
- [ ] モーダルが閉じる
- [ ] カメラが停止する（Webカメラのランプが消える）
- [ ] メイン画面に戻る

---

## 詳細機能テスト

### テスト4: 画面サイズ変更への対応

このテストでは、ブラウザのウィンドウサイズを変更したときに、ガイドが正しく追従するかを確認します。

#### 手順
1. カメラモーダルを開く
2. ガイド枠が表示されることを確認
3. ブラウザのウィンドウを **横に広げる**
4. 少し待つ（0.2秒程度）
5. ブラウザのウィンドウを **縦に広げる**
6. 少し待つ

#### ✅ 確認ポイント
- [ ] ウィンドウサイズを変えても、ガイド枠が **中央に保たれる**
- [ ] ガイド枠のサイズが **画面に合わせて調整される**
- [ ] テキストが常に **読める位置** にある
- [ ] 操作ボタンと枠が **重ならない**
- [ ] ガイドがはみ出さない

---

### テスト5: スマートフォンでの回転テスト（Android実機）

#### 事前準備: スマートフォンでアクセス
1. スマートフォンとPCを **同じWi-Fi** に接続
2. PCのIPアドレスを確認
   - **Windows**: コマンドプロンプトで `ipconfig` → IPv4アドレスを確認
   - **Mac**: ターミナルで `ifconfig | grep inet` → inet のアドレスを確認
3. スマートフォンのブラウザ（Chrome）で以下にアクセス：
   ```
   http://[PCのIPアドレス]:8000
   ```
   例: `http://192.168.1.100:8000`

💡 **ヒント**: IPアドレスがわからない場合は、PC側のコマンドプロンプトに表示されることがあります

#### 手順
1. スマートフォンで「📷 カメラで撮影」ボタンをタップ
2. カメラの許可を求められたら「許可」をタップ
3. ガイド枠が表示されることを確認
4. スマートフォンを **縦向き** に持つ
5. ガイドの配置を確認
6. スマートフォンを **横向き** に回転させる
7. 少し待つ（0.2〜0.5秒）
8. ガイドの配置を確認
9. もう一度 **縦向き** に戻す

#### ✅ 確認ポイント
- [ ] 縦向きでガイド枠が正しく表示される
- [ ] 横向きに回転しても、ガイド枠が **自動的に再配置** される
- [ ] 回転後もテキストが読める
- [ ] 回転後も操作ボタンが使える
- [ ] 回転中に一瞬ズレることがあるが、すぐに正しい位置に戻る
- [ ] 何度回転してもガイドが崩れない

---

### テスト6: ガイドが操作を邪魔しないことの確認

このテストでは、ガイドが表示されていても、操作ボタンが正常にクリックできるかを確認します。

#### 手順
1. カメラモーダルを開く
2. ガイド枠が表示されることを確認
3. 「📸 シャッター」ボタンを **連続で5回** クリック

#### ✅ 確認ポイント
- [ ] 1回目のクリックで撮影が開始される
- [ ] 2〜5回目のクリックは無視される（連打防止が動作）
- [ ] ガイドがボタンのクリックを邪魔していない

#### 手順2
1. 再度カメラプレビューを表示
2. ガイド枠の **上** にマウスカーソルを置く
3. クリックしてみる

#### ✅ 確認ポイント
- [ ] ガイド枠をクリックしても何も起こらない
- [ ] ガイド枠がクリックイベントを横取りしていない（`pointer-events: none` が効いている）

---

### テスト7: ブラウザの開発者ツールでの確認

このテストは、技術的な詳細を確認したい方向けです（スキップ可能）。

#### 手順
1. カメラモーダルを開く
2. ブラウザで `F12` キーを押して開発者ツールを開く
3. 「Console（コンソール）」タブを選択

#### ✅ 確認ポイント
- [ ] `[Camera] カメラ起動成功` というログが表示される
- [ ] `[Camera] ガイドを初期化しました` というログが表示される
- [ ] `Guide layout updated` というログが表示される
- [ ] エラー（赤いメッセージ）が表示されていない

#### 手順2: DOM構造の確認
1. 開発者ツールで「Elements（要素）」タブを選択
2. `Ctrl + F` を押して検索ボックスを表示
3. `.camera-guide` と入力して検索

#### ✅ 確認ポイント
- [ ] `.camera-guide` という要素が見つかる
- [ ] その中に `.camera-guide__frame` という要素がある
- [ ] その中に `.camera-guide__text` という要素がある
- [ ] スタイルが正しく適用されている

#### 手順3: ガイドのサイズ確認
1. 開発者ツールで `.camera-guide__frame` をクリック
2. 右側の「Computed（計算済み）」タブを確認

#### ✅ 確認ポイント
- [ ] `position: absolute` になっている
- [ ] `width` と `height` に具体的な値（px）が設定されている
- [ ] `left` と `top` に具体的な値が設定されている
- [ ] `box-shadow` が設定されている（マスク効果）

---

## トラブルシューティング

### カメラが起動しない

#### 症状
「カメラで撮影」ボタンをクリックしても、カメラが起動しない

#### 原因と対処法

**原因1: カメラの許可をブロックしている**
- ブラウザのアドレスバー左側のアイコン（🔒または🎥）をクリック
- 「カメラ」の設定を「許可」に変更
- ページを再読み込み（`F5`）

**原因2: HTTPSでアクセスしていない**
- URLが `http://localhost` または `http://127.0.0.1` で始まっているか確認
- `file://` で始まっている場合は、開発サーバーを起動してアクセスし直す

**原因3: カメラが他のアプリで使用中**
- Zoom、Skype、Teamsなどのビデオチャットアプリをすべて終了
- ブラウザの他のタブでカメラを使っている場合は閉じる

**原因4: カメラドライバの問題（Windows）**
- デバイスマネージャーを開く（`Windows + X` → デバイスマネージャー）
- 「カメラ」または「イメージングデバイス」を展開
- カメラデバイスを右クリック → 「デバイスを有効にする」

---

### ガイドが表示されない

#### 症状
カメラは起動するが、ガイド枠やテキストが表示されない

#### 対処法

**手順1: ブラウザの開発者ツールでエラーを確認**
1. `F12` キーを押す
2. 「Console」タブを開く
3. 赤いエラーメッセージがないか確認

**手順2: JavaScriptファイルの読み込み確認**
1. 開発者ツールの「Network」タブを開く
2. ページを再読み込み（`F5`）
3. `camera.js` が正常に読み込まれているか確認（Status が 200）

**手順3: キャッシュをクリア**
1. `Ctrl + Shift + Delete` を押す
2. 「キャッシュされた画像とファイル」にチェック
3. 「データを削除」をクリック
4. ページを再読み込み

**手順4: ハードリロード**
- `Ctrl + Shift + R`（Mac: `Cmd + Shift + R`）を押す
- キャッシュを無視して再読み込みされる

---

### ガイドの位置がおかしい

#### 症状
- ガイド枠がボタンと重なっている
- ガイドが画面からはみ出している
- ガイドが中央に配置されていない

#### 対処法

**手順1: 画面サイズを変更してみる**
1. ブラウザのウィンドウサイズを少し変更
2. 0.2秒ほど待つ
3. ガイドが再配置されるか確認

**手順2: モーダルを開き直す**
1. 「閉じる」ボタンでモーダルを閉じる
2. もう一度「カメラで撮影」ボタンをクリック
3. ガイドが正しく表示されるか確認

**手順3: ページを再読み込み**
- `F5` キーを押してページを再読み込み
- もう一度カメラを起動

---

### 回転時にガイドが追従しない（スマートフォン）

#### 症状
スマートフォンを回転させても、ガイドが再配置されない

#### 対処法

**手順1: 画面の自動回転がONか確認**
- Android: 通知バーを下にスワイプ → 「自動回転」または「画面の自動回転」がONか確認
- iOS: コントロールセンター → 「画面縦向きのロック」がOFFか確認

**手順2: ブラウザで全画面表示を試す**
- Chromeのメニュー（⋮）→ 「全画面表示」
- 回転してみる

**手順3: 時間を置いてみる**
- 回転後、0.5〜1秒ほど待つ
- デバウンス処理により、少し遅れて再配置される

---

### テキストが読めない

#### 症状
案内テキストやヒントが見づらい、または表示されない

#### 対処法

**確認1: テキストの色とコントラスト**
- 明るい背景では白文字が見えにくいことがある
- CSS で `text-background-color` が `rgba(0, 0, 0, 0.7)` になっているか確認

**確認2: フォントサイズ**
- スマートフォンでテキストが小さすぎる場合は、CSS の `.camera-guide__text` の `font-size` を調整
- 推奨: モバイルで16px以上

**確認3: 照明環境**
- 暗い部屋では画面の明るさを上げる
- 明るい場所では反射に注意

---

## ✅ テスト完了チェックリスト

すべてのテストが完了したら、以下のチェックリストを確認してください。

### 基本動作
- [ ] カメラモーダルが開く
- [ ] カメラが起動する
- [ ] ガイド枠が表示される
- [ ] 案内テキストが表示される
- [ ] マスク（暗い部分）が表示される

### 操作性
- [ ] シャッターボタンが押せる
- [ ] 閉じるボタンが押せる
- [ ] ガイドがボタンを邪魔しない
- [ ] 撮影後にガイドが消える
- [ ] 再撮影でガイドが再表示される

### レスポンシブ対応
- [ ] ブラウザのウィンドウサイズを変えてもガイドが追従する
- [ ] スマートフォンで縦/横回転してもガイドが追従する
- [ ] ガイドが画面からはみ出さない
- [ ] ガイドが操作UIと重ならない

### クリーンアップ
- [ ] モーダルを閉じるとガイドが削除される
- [ ] 開発者ツールでメモリリークがない（DOM要素が増殖していない）

---

## 🎉 テスト完了！

すべてのテストが成功した場合、撮影ガイド機能は正常に動作しています。

### 次のステップ
- Phase 2 Step 2-4: OCR機能の実装へ進む
- または、実際に血圧計を撮影してみて、使い勝手を確認する

---

## 📞 サポート

問題が解決しない場合は、以下の情報を添えて報告してください：
- 使用しているOS（Windows/Mac/Android）
- 使用しているブラウザ（Chrome/Safari等）とバージョン
- 開発者ツールのConsoleに表示されているエラーメッセージ
- 問題が発生する手順

---

**作成日**: 2026年2月13日  
**対象**: Phase 2 Step 2-3 撮影ガイド機能  
**バージョン**: 1.0
