```md
# ProjectRules.md（Cursor Project Rules 貼り付け用）

## 1. 目的とスコープ
- 目的: 血圧記録アプリの見た目と操作性を「清潔感のある医療系デザイン」「高齢者でも使いやすい大きく見やすいUI」に統一し、主要画面（入力/一覧/グラフ/モーダル）を同一のデザインシステムで整える。
- スコープ（やること）:
  - `css/style.css` をデザイントークン（CSS変数）＋共通コンポーネント（カード/ボタン/入力/テーブル/モーダル/メッセージ）の体系に刷新
  - `index.html` は「構造整理（セクション分割、カード化、必要なクラス付与、フォント/アイコン読み込み）」のみ（既存機能のJSが壊れない範囲で最小変更）
  - レスポンシブ（スマホ/タブレット/PC）とアクセシビリティ（フォーカス可視化、タップ領域）を最終調整
- 非スコープ（やらないこと）:
  - 既存機能の仕様変更（入力/保存/一覧更新/グラフ更新のロジック変更）
  - 新規機能追加（Step4-2以降：グラフ強化、エクスポート、通知、オフライン強化など）
  - UIフレームワーク導入（React/Vue/Tailwind/Bootstrap 等）

## 2. 技術スタック
- 使用言語: HTML / CSS / JavaScript（既存構成に準拠）
- 前提:
  - PWA（モバイルファースト）を想定し、低スペック端末でも重くしない
  - 既存JSが参照している `id` / 主要クラス名 / data属性は可能な限り維持する（DOMの大移動は避ける）
- TODO（未確定）:
  - アイコンセット選定（例: Material Symbols / Font Awesome / 自前SVG）
  - フォント選定（例: Noto Sans JP / system-ui）

## 3. ディレクトリ/ファイル方針
- 主要ファイル（本Stepで確実に触る）:
  - `index.html`
  - `css/style.css`
- 推奨（既存があれば合わせる。無ければ追加は最小）:
  - `js/*.js`（既存ロジック。UI改修では原則触らない）
  - `assets/icons/`（CDN依存を減らす場合のSVG/アイコン置き場）
- 読み込み順:
  - HTML → CSS → JS
- CSSのセクション分割ルール（1ファイルのまま見通し良くする）:
  - `:root`（トークン）
  - `base`（reset/typography/layout）
  - `components`（card/button/form/table/modal/badge/alert 等）
  - `utilities`（.sr-only, .visually-hidden, .stack, .inline 等）
  - `responsive`（メディアクエリ）

## 4. コーディング規約（横断）
- 命名:
  - CSS: BEM（`block__elem--mod`）を基本（既存の主要クラスは維持しつつ、追加分はBEMで統一）
  - JS: lowerCamelCase（既存に合わせる）。関数/変数は略語を避け、意図が伝わる名前。
- コメント: 原則日本語。意図・入出力・副作用（DOM更新/Storage更新など）を1行で明記。
- 層分離:
  - 設定/定数・ドメインロジック・I/O・UI更新を分ける（UI改修でJSを触る場合は最小限に留める）
- 禁止:
  - 魔法数の散在（CSSトークン、もしくは変数/定数に寄せる）
  - 過度な詳細度（`#id .a .b` 連鎖）で上書き合戦になるCSS

## 5. 実装ルール（プロジェクト固有：Step4-1 デザインの洗練）

### 5.1 デザイントークン（CSS変数）
- すべての「色/余白/角丸/影/フォントサイズ/境界線」は `:root` の変数で管理する。
- 必須トークン（例。名称は統一すればOK）:
  - Colors: `--color-bg`, `--color-surface`, `--color-text`, `--color-muted`, `--color-primary`, `--color-primary-contrast`, `--color-border`, `--color-danger`, `--color-warning`, `--color-success`, `--color-focus`
  - Typography: `--font-sans`, `--font-size-base(>=16px)`, `--font-size-lg`, `--line-height(≈1.6)`, `--font-weight-regular`, `--font-weight-semibold`
  - Spacing: `--space-1..n`（例: 4/8/12/16/24/32）
  - Radius/Shadow: `--radius-sm/md/lg`, `--shadow-sm/md`
  - Touch target: `--tap-size: 48px`（ボタン/入力の最小高さに使用）
- ハードコードのRGB/pxを増やさない。追加が必要なら先にトークンを増やす。

### 5.2 ページ骨格（レイアウト/カード/セクション）
- モバイルファースト: まず 360〜430px 幅で完成させ、次に 768px（タブレット）、1024px+（PC）で拡張。
- コンテナ:
  - 横幅は `max-width` を設ける（例: 960〜1100px）
  - 余白はトークンで統一（例: `padding-inline: var(--space-4)`）
- カード:
  - 主要領域（入力/一覧/グラフ/設定/ヘルプ等）はカードで区切る
  - カード見出し（タイトル）・本文・補助情報の階層を明確に
- `index.html` 構造整理のルール:
  - 既存JSが参照する `id` を維持
  - 要素の「移動・入れ子変更」は最小限（必要なら同一idを保ったままラップ要素を追加する）

### 5.3 入力フォーム/ボタン/メッセージ（コンポーネント統一）
- ボタン:
  - `.btn` を基底にし、`.btn--primary`, `.btn--secondary`, `.btn--danger` 等のモディファイアで表現
  - 状態（hover/active/disabled/focus-visible）を全ボタンで統一
  - 最小タップ領域: 高さ `>= var(--tap-size)`、横も十分（アイコンのみボタンは特に注意）
- 入力:
  - `.field`, `.field__label`, `.field__control`, `.field__help`, `.field__error` を基本構造に
  - エラー表示は「どこを直すか」が分かる文言 + 対象コントロールの枠色/メッセージで明示
- メッセージ:
  - 成功/警告/エラーを `.alert`（`.alert--success/warn/danger`）で統一

### 5.4 アイコン/フォント
- フォント:
  - フォールバックを含めて定義（例: `--font-sans: system-ui, -apple-system, "Noto Sans JP", sans-serif;`）
  - 可能なら表示遅延対策（`font-display` 相当）を考慮。CDN利用時はPWAオフラインでの劣化を許容するか、Step4-5でキャッシュ設計する。
- アイコン:
  - 主要操作（追加/保存/編集/削除/戻る/設定 等）の意味補助に限定し、装飾過多にしない
  - クリック可能要素には `aria-label` を付与（アイコンのみの場合は必須）
- TODO（選定方針）:
  - A案: CDN（導入が早い）
  - B案: `assets/icons/` にSVGを置いてローカル参照（PWAオフラインに強い）

### 5.5 レスポンシブ/アクセシビリティ最終調整
- ブレークポイント（目安）:
  - `@media (min-width: 768px)`：カードの並び/余白拡張
  - `@media (min-width: 1024px)`：最大幅の固定、表の可読性改善
- アクセシビリティ最低条件:
  - 最小フォント: 16px 以上（補助テキストでも読める範囲）
  - 行間: 1.5〜1.7
  - フォーカス可視化: `:focus-visible` で明確なリング（`--color-focus`）
  - コントラスト: 文字色と背景色のコントラストを確保（淡すぎるグレー禁止）
  - タップ領域: 48px 以上

## 6. UI/UX・入力操作の規約
- ボタン/リンク:
  - クリック領域（padding込み）で48pxを満たす
  - 連打・二重送信を避けるUI（disabled状態の見た目を用意）
- フォーム:
  - ラベルは省略しない（プレースホルダーだけに依存しない）
  - エラーは上部まとめ＋各フィールド直下の両方で出せる設計が理想（既存実装に合わせて最小対応）
- 一覧/グラフ:
  - 画面幅が狭いときに読めるように折返し/スクロール/カード化のいずれかで破綻を防ぐ（既存形式を維持しつつ改善）

## 7. パフォーマンス/品質
- 低スペック端末前提:
  - 過度なアニメーション禁止（必要なら `prefers-reduced-motion` を尊重）
  - 巨大画像・重い影・フィルター多用を避ける
- CSS品質:
  - できるだけ合成プロパティ（transform/opacity）中心に
  - レイアウトを頻繁に変えるプロパティ（top/left/widthのアニメ）を避ける

## 8. テスト/デバッグ（DoD）
- 主要フロー（必須）:
  - 入力 → 保存 → 一覧更新 → グラフ更新 がUI改修後も動作する（id参照が壊れていない）
- 画面チェック（必須）:
  - 入力/一覧/グラフ/モーダル等の主要画面で、カード/ボタン/入力のスタイルが統一
  - スマホ幅（360〜430px）: 横スクロールが出ない
  - タブレット（768px前後）: 余白が広がりすぎず読みやすい
  - PC（1024px+）: 最大幅が適切、情報が散らばらない
- アクセシビリティ（必須）:
  - キーボードTab移動でフォーカスが常に視認できる
  - アイコンのみボタンに `aria-label` がある
  - ボタン/入力のタップ領域が48px相当
- 可能なら（推奨）:
  - Lighthouseのアクセシビリティで致命的な指摘が出ない

## 9. リリース/更新運用
- `todo.md`/計画md更新 → Project Rulesへ差分反映（特に: ファイル構成、UI要件、数値条件）
- コミット粒度:
  - Plan単位でコミット（例: `Step4-1 Plan1: design tokens`）
  - Before/Afterのスクリーンショットを残せるなら添付

## 10. 禁止事項/アンチパターン
- 指定なしの外部フレームワーク導入
- CSSの上書き合戦（詳細度を上げて解決しない）
- `id` の削除/変更による既存JSの破壊
- アニメ/装飾のやりすぎ（医療系=清潔感/可読性優先）

## 11. コミット/PR運用（任意）
- 1コミット=1意図（トークン導入/カード化/フォーム統一…）
- PR（またはレビュー依頼）には「目的/変更点/確認観点/スクショ」を記載
```

```md
# 生成ログ（要約）
- 血圧記録アプリのStep4-1「デザインの洗練」計画から、CSSトークン化・カード化・フォーム/ボタン統一・アイコン/フォント・レスポンシブ/アクセシビリティをProject Rulesに落とし込み。
- 既存JSのDOM参照破壊を避けるため、`id`/主要クラスの維持とHTML構造変更の最小化を明文化。
- 数値条件（最小フォント16px、タップ領域48px、確認幅360〜430/768/1024+）を具体化。
- 未確定（TODO）として、アイコンセット/フォント選定と、CDN vs ローカルSVGの方針を明記。
```

